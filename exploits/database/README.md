# Exploit Database Search Module

## Overview

The Exploit Database Search Module (Phase 9A) provides unified search across multiple exploit sources:
- **ExploitDB** - via searchsploit CLI
- **GitHub** - POC exploits and repositories
- **Metasploit** - Framework modules

## Architecture

```
exploits/database/
├── __init__.py
├── search.py           # Main ExploitSearch class
├── exploitdb.py        # ExploitDB/searchsploit integration
├── github_pocs.py      # GitHub API search
└── metasploit.py       # Metasploit framework search
```

## CLI Commands

### Search Exploits

```bash
# Search all sources
akali exploit search "wordpress sql injection"

# Search specific source
akali exploit search "CVE-2021-44228" --source github
akali exploit search "ms17-010" --source metasploit
akali exploit search "webapp" --source exploitdb

# Filter by category
akali exploit search "RCE" --category webapp
```

### Download Exploits

```bash
# Download from ExploitDB
akali exploit download EDB-12345

# Download from GitHub
akali exploit download https://github.com/user/repo/blob/main/exploit.py --output poc.py

# Default output path
akali exploit download EDB-12345
```

### List Categories

```bash
# List all exploit categories
akali exploit list

# Filter by platform
akali exploit list --platform windows
```

### CVE Lookup (Legacy)

```bash
# Look up CVE details
akali exploit lookup CVE-2021-44228
```

## Python API

### Basic Usage

```python
from exploits.database.search import ExploitSearch

searcher = ExploitSearch()

# Search all sources
results = searcher.search_all("CVE-2021-44228")

# Search specific source
exploitdb_results = searcher.search_exploitdb("wordpress")
github_results = searcher.search_github_pocs("log4shell")
msf_results = searcher.search_metasploit("eternalblue")

# Download exploit
success = searcher.download_exploit("EDB-12345", "/tmp/exploit.txt")
```

### ExploitDB Client

```python
from exploits.database.exploitdb import ExploitDBClient

client = ExploitDBClient()

# Check if searchsploit is available
if client.check_available():
    # Search by term
    results = client.search("apache")

    # Search by CVE
    results = client.search_by_cve("CVE-2021-1234")

    # Get exploit path
    path = client.get_exploit_path("12345")

    # Download exploit
    client.download_exploit("12345", "/tmp/exploit.txt")
```

### GitHub POC Search

```python
from exploits.database.github_pocs import GitHubPOCSearch

searcher = GitHubPOCSearch(api_token="optional_token")

# Search repositories
results = searcher.search("CVE-2021-44228")

# Search code
code_results = searcher.search_code("exploit.py CVE-2021")

# Filter by stars
popular = searcher.filter_by_stars(results, min_stars=50)

# Download POC
searcher.download("https://github.com/user/repo/blob/main/poc.py", "poc.py")
```

### Metasploit Search

```python
from exploits.database.metasploit import MetasploitSearch

searcher = MetasploitSearch()

# Check if Metasploit is available
if searcher.check_available():
    # Search modules
    results = searcher.search("ms17-010")

    # Get module info
    info = searcher.get_module_info("exploit/windows/smb/ms17_010_eternalblue")

    # Get module options
    options = searcher.get_module_options("exploit/windows/smb/ms17_010_eternalblue")
```

## Result Format

All search methods return standardized dictionaries:

```python
{
    'id': 'EDB-12345',           # Exploit ID
    'title': 'Exploit Title',    # Name/title
    'source': 'exploitdb',       # Source (exploitdb/github/metasploit)
    'description': '...',        # Description (optional)
    'date': '2021-01-15',       # Publication date (optional)
    'author': 'John Doe',       # Author (optional)
    'url': 'https://...',       # URL (optional)
    'stars': 100,               # GitHub stars (optional)
    'rank': 'average',          # Metasploit rank (optional)
    'platform': 'php',          # Platform (optional)
    'type': 'webapps'           # Type/category (optional)
}
```

## External Dependencies

### Required
- Python 3.8+ with `requests` package

### Optional (for full functionality)
- **searchsploit** - ExploitDB search
  ```bash
  git clone https://github.com/offensive-security/exploitdb.git /opt/exploitdb
  ln -sf /opt/exploitdb/searchsploit /usr/local/bin/searchsploit
  ```

- **Metasploit Framework** - MSF module search
  ```bash
  curl https://raw.githubusercontent.com/rapid7/metasploit-omnibus/master/config/templates/metasploit-framework-wrappers/msfupdate.erb > msfinstall
  chmod 755 msfinstall
  ./msfinstall
  ```

- **GitHub API Token** - Higher rate limits
  ```bash
  export GITHUB_TOKEN="your_token_here"
  ```

## Testing

```bash
# Run all tests
pytest tests/exploits/database/ -v

# Run specific test file
pytest tests/exploits/database/test_search.py -v

# Run with coverage
pytest tests/exploits/database/ --cov=exploits.database --cov-report=html
```

## Error Handling

All methods gracefully handle missing external tools:

- **searchsploit not installed** - Returns empty list
- **msfconsole not available** - Returns empty list
- **GitHub API rate limit** - Returns empty list
- **Network errors** - Returns empty list

No exceptions are raised for missing tools - the module degrades gracefully.

## Performance

- **ExploitDB**: Fast (local database, milliseconds)
- **GitHub**: Medium (API calls, 1-2 seconds)
- **Metasploit**: Slow (msfconsole startup, 10-30 seconds)

For best performance when searching all sources, consider:
1. Using specific sources when you know what you need
2. Implementing caching for repeated searches
3. Running searches in parallel (already done in `search_all()`)

## Future Enhancements

- [ ] Caching layer for repeated searches
- [ ] VulnDB integration
- [ ] Packet Storm Security integration
- [ ] CVE-to-exploit mapping
- [ ] Automatic exploit testing/validation
- [ ] Local exploit database mirroring
- [ ] Advanced filtering (severity, date range, platform)

## License

Part of Akali Security Platform - MIT License
